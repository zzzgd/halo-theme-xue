var coffeeModal={toggleCoffeeModal:function(){$("#buyCoffee").on("click",function(){var coffeeModal=$("#coffeeModal");coffeeModal.addClass("is-open");coffeeModal.attr("aria-hidden","false")});$("#closeCoffeeModalBtn").on("click",function(){var coffeeModal=$("#coffeeModal");coffeeModal.attr("aria-hidden","true");setTimeout(function(){coffeeModal.removeClass("is-open")},100)})},initShowCode:function(){var firstCode=$("#coffeeModalContent").children(":first");if(firstCode){firstCode.addClass("qr-code-visible");var codeData=firstCode.attr("code-data");$("#coffeeModalTitle").text(codeData)}},switchQrCode:function(){$("#zfbBtn").on("click",function(){var $qrCodeZfb=$("#qrCodeZfb");$qrCodeZfb.addClass("qr-code-visible");$("#qrCodeWx").removeClass("qr-code-visible");$("#coffeeModalTitle").text("支付宝")});$("#wxBtn").on("click",function(){var $qrCodeWx=$("#qrCodeWx");$qrCodeWx.addClass("qr-code-visible");$("#qrCodeZfb").removeClass("qr-code-visible");$("#coffeeModalTitle").text("微信支付")})}};$(function(){coffeeModal.toggleCoffeeModal();coffeeModal.initShowCode();coffeeModal.switchQrCode()});
var moonMenu={smoothBack2Top:function(){window.scroll({top:0,behavior:"smooth"})},smoothBack2Bottom:function(){const offsetHeight=document.documentElement.offsetHeight;const scrollHeight=document.documentElement.scrollHeight;window.scroll({top:scrollHeight-offsetHeight,behavior:"smooth"})},ckBack2Top:function(){$(".icon-up").on("click",function(){moonMenu.smoothBack2Top()})},ckBack2Bottom:function(){$(".icon-down").on("click",function(){moonMenu.smoothBack2Bottom()})},ckShowContent:function(){$(".icon-toc").on("click",function(){$("#moonToc").toggleClass("mm-active")})},initMoonToc:function(){var headerEl="h1,h2,h3,h4,h5,h6",content=".md-content";tocbot.init({tocSelector:"#moonToc",contentSelector:content,headingSelector:headerEl,scrollSmooth:true,isCollapsedClass:"",headingsOffset:0-($("#postHeader").height()+58),hasInnerContainers:false,})},searchBox:function(){$(".icon-search").on("click",function(){$("#searchBox").toggleClass("hidden")});$(".sh-exit").on("click",function(){$("#searchBox").toggleClass("hidden")})},toggleCircle:function(){var $moonDot=$("g.moon-dot");var firstCircle=$moonDot.children("circle:first");var lastCircle=$moonDot.children("circle:last");var cy=$(firstCircle).attr("cy");if(cy==="0"){$(firstCircle).attr("cx","0");$(firstCircle).attr("cy","-.8rem");$(lastCircle).attr("cx","0");$(lastCircle).attr("cy",".8rem")}else{$(firstCircle).attr("cx","-.8rem");$(firstCircle).attr("cy","0");$(lastCircle).attr("cx",".8rem");$(lastCircle).attr("cy","0")}},ckMoonButton:function(){$(".moon-menu-button").on("click",function(){moonMenu.toggleCircle();$(".moon-menu-items").toggleClass("item-ani")})},};$(function(){moonMenu.ckMoonButton();moonMenu.ckBack2Top();moonMenu.ckBack2Bottom();moonMenu.searchBox();var Obj=$("#tocFlag");if(Obj.length!==1){return false}moonMenu.initMoonToc();moonMenu.ckShowContent()});
var nightModeId="nightMode";var nightMode={clickNightMode:function(){$("#switch_Word").on("change",function(){var isChecked=$("#switch_Word").prop("checked");nightMode.changeNightMode(isChecked)})},changeNightMode:function(checked){checked=!!checked;if(checked){$(document.body).addClass("night");hanUtils.setLocalStorage(nightModeId,true);$("#switch_Word").attr("checked",true)}else{$(document.body).removeClass("night");hanUtils.setLocalStorage(nightModeId,false);$("#switch_Word").attr("checked",false)}if(typeof renderComment==="function"){renderComment()}},autoNightMode:function(){var day=new Date();var hour=day.getHours();var isNight=hanUtils.getLocalStorage(nightModeId);if((hour<6||hour>=20)&&autoNightModeOpen){nightMode.changeNightMode(isNight)}else{nightMode.changeNightMode(isNight)}},};$(function(){nightMode.clickNightMode();nightMode.autoNightMode()});
var katex_config={delimiters:[{left:"$$",right:"$$",display:true},{left:"$",right:"$",display:false},{left:"\\(",right:"\\)",display:false},{left:"\\[",right:"\\]",display:true},]};var hanUtils={getLocalStorage:function(key){var exp=60*60*1000;if(localStorage.getItem(key)){var vals=localStorage.getItem(key);var dataObj=JSON.parse(vals);var isTimed=(new Date().getTime()-dataObj.timer)>exp;if(isTimed){console.log("存储已过期");localStorage.removeItem(key);return null}else{var newValue=dataObj.val}return newValue}else{return null}},isQuotaExceeded:function(e){var quotaExceeded=false;if(e){if(e.code){switch(e.code){case 22:quotaExceeded=true;break;case 1014:if(e.name==="NS_ERROR_DOM_QUOTA_REACHED"){quotaExceeded=true}break}}else{if(e.number===-2147024882){quotaExceeded=true}}}return quotaExceeded},setLocalStorage:function(key,value){var curtime=new Date().getTime();var valueDate=JSON.stringify({val:value,timer:curtime});try{localStorage.removeItem(key);localStorage.setItem(key,valueDate)}catch(e){if(isQuotaExceeded(e)){console.log("Error: 本地存储超过限制");localStorage.clear()}else{console.log("Error: 保存到本地存储失败")}}},sheetViewer:function(){if(document.getElementById("sheetContent")){const viewer=new Viewer(document.getElementById("sheetContent"),{toolbar:false,})}},journalViewer:function(){if(document.getElementById("tree-hole")){const viewer=new Viewer(document.getElementById("tree-hole"),{toolbar:false,filter:function(image){if(!image.classList){return true}return !image.classList.contains("avatar")},})}},highlightMenu:function(){var nav=document.getElementById("menuLinks");var links=nav.getElementsByClassName("link");var currenturl=document.location.pathname;var last=0;if(links){for(var i=0;i<links.length;i++){var linkurl=links[i].getAttribute("href");if(currenturl.indexOf(linkurl)!==-1){if(currenturl.indexOf(linkurl)!==-1){last=i}}}$(links[last]).addClass("current");for(var i=0;i<links.length;i++){if(last!==i){$(links[i]).removeClass("current")}}}}};$(function(){hanUtils.sheetViewer();
    hanUtils.journalViewer();hanUtils.highlightMenu()});
var photo={loadGallery:function(){if(document.getElementById("gallery-content")){new Viewer(document.getElementById("gallery-content"),{toolbar:true,})}if(typeof($.fn.justifiedGallery)==="function"){if($(".justified-gallery > p > .gallery-item").length){$(".justified-gallery > p > .gallery-item").unwrap()}$(".justified-gallery").justifiedGallery({rowHeight:230,margins:4})}}};document.addEventListener("DOMContentLoaded",photo.loadGallery);